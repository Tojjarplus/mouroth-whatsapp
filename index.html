<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ§ØªØ³Ø§Ø¨ - Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ«</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #e6ddd4;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .whatsapp-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            min-height: 600px;
            max-height: 800px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .whatsapp-header {
            background: #075e54;
            color: white;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .back-btn {
            color: white;
            font-size: 1.1em;
        }

        .contact-info {
            flex: 1;
            min-width: 0;
        }

        .contact-name {
            font-weight: bold;
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contact-status {
            font-size: 0.75em;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-icons {
            display: flex;
            gap: 12px;
            color: white;
            font-size: 0.9em;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path fill="%23075e54" d="M20,20 C40,0 60,20 80,10 C100,0 80,40 60,40 C40,40 20,60 20,80 C20,100 0,60 0,40 C0,20 0,40 20,20 Z"/></svg>');
            -webkit-overflow-scrolling: touch;
        }

        .message {
            max-width: 85%;
            padding: 10px 12px;
            margin: 8px 0;
            border-radius: 10px;
            position: relative;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .received {
            background: white;
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .sent {
            background: #dcf8c6;
            align-self: flex-end;
            margin-left: auto;
            border-top-right-radius: 0;
        }

        .message-time {
            font-size: 0.65em;
            color: #999;
            text-align: left;
            margin-top: 4px;
        }

        /* Menu Messages */
        .menu-message {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .menu-title {
            font-weight: bold;
            color: #075e54;
            margin-bottom: 8px;
            text-align: center;
            font-size: 0.95em;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        /* ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¯Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .item-image {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-name {
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
            margin-bottom: 2px;
        }

        .item-description {
            font-size: 0.75em;
            color: #666;
            line-height: 1.3;
        }

        .item-price {
            font-weight: bold;
            color: #25d366;
            font-size: 0.85em;
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* Input Area */
        .input-area {
            padding: 12px;
            background: #f0f0f0;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .message-input {
            flex: 1;
            padding: 10px 12px;
            border: none;
            border-radius: 20px;
            outline: none;
            font-size: 0.9em;
            min-width: 0;
        }

        .send-btn {
            background: #25d366;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .send-btn:hover {
            background: #128c7e;
        }

        /* Quick Replies */
        .quick-replies {
            display: flex;
            gap: 8px;
            padding: 8px 12px;
            background: #f0f0f0;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .quick-reply {
            background: white;
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 18px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .quick-reply:hover {
            background: #25d366;
            color: white;
            border-color: #25d366;
        }

        /* Order Summary */
        .order-summary {
            background: #fff8e1;
            border: 2px solid #ffd54f;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
        }

        .order-title {
            font-weight: bold;
            color: #ff6f00;
            margin-bottom: 8px;
            text-align: center;
            font-size: 0.9em;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dashed #ddd;
            font-size: 0.85em;
        }

        .order-total {
            font-weight: bold;
            color: #d32f2f;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px solid #ffd54f;
            text-align: center;
            font-size: 0.9em;
        }

        /* Payment Options */
        .payment-options {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
        }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: #25d366;
            background: #f9f9f9;
        }

        .payment-option.selected {
            border-color: #25d366;
            background: #f0f9f0;
        }

        .payment-icon {
            font-size: 1.3em;
            width: 35px;
            text-align: center;
            flex-shrink: 0;
        }

        .payment-info {
            flex: 1;
            min-width: 0;
        }

        .payment-name {
            font-weight: bold;
            color: #333;
            font-size: 0.85em;
        }

        .payment-desc {
            font-size: 0.75em;
            color: #666;
        }

        .stcpay-color {
            color: #0070ba;
        }

        .mada-color {
            color: #00a2ff;
        }

        .visa-color {
            color: #1a1f71;
        }

        /* Location Button */
        .location-btn {
            background: #25d366;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 8px auto;
            transition: background 0.3s;
            font-size: 0.85em;
        }

        .location-btn:hover {
            background: #128c7e;
        }

        .location-message {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            text-align: center;
        }

        /* Special Offer Banner */
        .offer-banner {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            margin: 8px 0;
            font-weight: bold;
            font-size: 0.8em;
        }

        /* Loyalty Points Message */
        .loyalty-message {
            background: linear-gradient(135deg, #ffd700, #ff6b00);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: center;
            font-weight: bold;
        }

        .points-badge {
            background: white;
            color: #ff6b00;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 1em;
            margin: 8px 0;
            display: inline-block;
            font-weight: bold;
        }

        /* Rating System */
        .rating-message {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 8px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .rating-title {
            font-weight: bold;
            color: #075e54;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .stars-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
        }

        .star {
            font-size: 2em;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
            padding: 5px;
        }

        .star:hover {
            color: #ffd700;
        }

        .star.active {
            color: #ffd700;
        }

        .rating-text {
            font-size: 0.9em;
            color: #666;
            margin: 10px 0;
            min-height: 20px;
        }

        .submit-rating {
            background: #25d366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .submit-rating:hover {
            background: #128c7e;
        }

        .rating-thanks {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: center;
            font-weight: bold;
        }

        /* New Styles for Enhanced Features */
        .loading-dots {
            display: flex;
            gap: 4px;
            margin: 8px 0;
        }

        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #25d366;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .order-status {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: center;
        }

        .combo-offer {
            background: linear-gradient(135deg, #FF9800, #FF5722);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 8px 0;
            text-align: center;
        }

        .combo-savings {
            background: white;
            color: #FF5722;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            margin: 8px 0;
            display: inline-block;
        }

        .preference-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .preference-option.selected {
            border-color: #25d366;
            background: #f0f9f0;
        }

        .reservation-slot {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 10px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            text-align: center;
            flex: 1;
            min-width: 80px;
        }

        .reservation-slot.selected {
            border-color: #25d366;
            background: #f0f9f0;
        }

        .reservation-slot.unavailable {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .catering-package {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 8px 0;
            cursor: pointer;
        }

        .catering-package:hover {
            border-color: #25d366;
        }

        .tier-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.8em;
            margin-left: 8px;
        }

        .bronze { background: #CD7F32; color: white; }
        .silver { background: #C0C0C0; color: black; }
        .gold { background: #FFD700; color: black; }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: center;
            border: 1px solid #ffcdd2;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: center;
            border: 1px solid #c8e6c9;
        }

        .review-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .review-stars {
            color: #ffd700;
            margin-bottom: 5px;
        }

        .gift-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 8px 0;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .whatsapp-container {
                height: 95vh;
                max-height: none;
                border-radius: 10px;
            }
            
            .whatsapp-header {
                padding: 10px 12px;
            }
            
            .chat-area {
                padding: 10px;
            }
            
            .message {
                max-width: 90%;
                padding: 8px 10px;
                margin: 6px 0;
                font-size: 0.9em;
            }
            
            .input-area {
                padding: 10px;
            }
            
            .quick-replies {
                padding: 6px 10px;
            }
            
            .quick-reply {
                padding: 5px 10px;
                font-size: 0.75em;
            }

            .star {
                font-size: 1.8em;
            }

            .reservation-slot {
                min-width: 70px;
                padding: 8px;
                font-size: 0.8em;
            }
        }

        @media (max-width: 360px) {
            .whatsapp-header {
                padding: 8px 10px;
            }
            
            .contact-name {
                font-size: 0.9em;
            }
            
            .contact-status {
                font-size: 0.7em;
            }
            
            .header-icons {
                gap: 8px;
                font-size: 0.8em;
            }
            
            .menu-item {
                gap: 8px;
                padding: 6px;
            }
            
            .item-name {
                font-size: 0.85em;
            }
            
            .item-description {
                font-size: 0.7em;
            }
            
            .payment-option {
                gap: 8px;
                padding: 8px;
            }
            
            .payment-icon {
                font-size: 1.1em;
                width: 30px;
            }

            .star {
                font-size: 1.6em;
            }
        }

        /* Touch improvements */
        @media (hover: none) {
            .menu-item:hover {
                background: transparent;
            }
            
            .quick-reply:hover {
                background: white;
                color: inherit;
                border-color: #ddd;
            }
            
            .payment-option:hover {
                border-color: #e0e0e0;
                background: transparent;
            }
            
            .send-btn:hover {
                background: #25d366;
            }
            
            .location-btn:hover {
                background: #25d366;
            }
            
            .submit-rating:hover {
                background: #25d366;
            }
            
            .star:hover {
                color: #ddd;
            }
        }

        /* Improve scrolling on mobile */
        .chat-area::-webkit-scrollbar {
            width: 4px;
        }

        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 2px;
        }

        /* Prevent text selection */
        .whatsapp-container {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Allow text selection in input only */
        .message-input {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
    </style>
</head>
<body>
    <div class="whatsapp-container">
        <!-- Header -->
        <div class="whatsapp-header">
            <div class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="contact-info">
                <div class="contact-name">Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ« <i class="fas fa-check-circle" style="color: #25d366; font-size: 0.8em;"></i></div>
                <div class="contact-status">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
            </div>
            <div class="header-icons">
                <i class="fas fa-video"></i>
                <i class="fas fa-phone"></i>
                <i class="fas fa-ellipsis-v"></i>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>

        <!-- Quick Replies -->
        <div class="quick-replies" id="quickReplies">
            <!-- Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <i class="fas fa-paperclip" style="color: #666; font-size: 1.1em;"></i>
            <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // ========== Ù…Ù†ÙŠÙˆ Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ« ==========
        const menuItems = [
            {
                id: 1,
                image: "images/mandi.jpg",
                name: "Ù„Ø­Ù… Ù…Ù†Ø¯ÙŠ",
                description: "Ù„Ø­Ù… Ù…Ù†Ø¯ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø² Ø§Ù„Ø¨Ø´Ø§ÙˆØ± Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙˆØ±ÙˆØ«",
                price: 65,
                category: "Ù„Ø­ÙˆÙ…",
                spicy: 2
            },
            {
                id: 2,
                image: "images/mazbi.jpg",
                name: "Ù„Ø­Ù… Ù…Ø¸Ø¨ÙŠ",
                description: "Ù„Ø­Ù… Ù…Ø¸Ø¨ÙŠ Ù…Ø´ÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø·Ø¨ Ù…Ø¹ Ø±Ø²",
                price: 70,
                category: "Ù„Ø­ÙˆÙ…",
                spicy: 3
            },
            {
                id: 3,
                image: "images/madghout.jpg",
                name: "Ù„Ø­Ù… Ù…Ø¶ØºÙˆØ·",
                description: "Ù„Ø­Ù… Ù…Ø¶ØºÙˆØ· Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",
                price: 60,
                category: "Ù„Ø­ÙˆÙ…",
                spicy: 2
            },
            {
                id: 4,
                image: "images/makboos.jpg",
                name: "Ù„Ø­Ù… Ù…ÙƒØ¨ÙˆØ³",
                description: "Ù„Ø­Ù… Ù…ÙƒØ¨ÙˆØ³ Ù…Ø¹ Ø±Ø² Ù…ØªØ¨Ù„",
                price: 60,
                category: "Ù„Ø­ÙˆÙ…",
                spicy: 2
            },
            {
                id: 5,
                image: "images/madfoon.jpg",
                name: "Ù„Ø­Ù… Ù…Ø¯ÙÙˆÙ†",
                description: "Ù„Ø­Ù… Ù…Ø¯ÙÙˆÙ† ÙÙŠ Ø§Ù„ØªÙ†ÙˆØ± Ù…Ø¹ Ø±Ø²",
                price: 75,
                category: "Ù„Ø­ÙˆÙ…",
                spicy: 1
            },
            {
                id: 6,
                image: "images/kabsa_mawrooth.jpg",
                name: "ÙƒØ¨Ø³Ø© Ø§Ù„Ù…ÙˆØ±ÙˆØ«",
                description: "ÙƒØ¨Ø³Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ø·Ø¹Ù… Ù…Ù…ÙŠØ²",
                price: 55,
                category: "Ø£Ø·Ø¨Ø§Ù‚ Ø®Ø§ØµØ©",
                spicy: 2
            },
            {
                id: 7,
                image: "images/hashi_madghout.jpg",
                name: "Ø­Ø§Ø´ÙŠ Ù…Ø¶ØºÙˆØ·",
                description: "Ù„Ø­Ù… Ø­Ø§Ø´ÙŠ Ù…Ø¶ØºÙˆØ· Ù…Ø¹ Ø±Ø²",
                price: 80,
                category: "Ù„Ø­ÙˆÙ… Ù…Ù…ÙŠØ²Ø©",
                spicy: 1
            },
            {
                id: 8,
                image: "images/hashi_makboos.jpg",
                name: "Ø­Ø§Ø´ÙŠ Ù…ÙƒØ¨ÙˆØ³",
                description: "Ø­Ø§Ø´ÙŠ Ù…ÙƒØ¨ÙˆØ³ Ù…Ø¹ Ø±Ø² Ø¨Ø´Ø§ÙˆØ±",
                price: 80,
                category: "Ù„Ø­ÙˆÙ… Ù…Ù…ÙŠØ²Ø©",
                spicy: 1
            },
            {
                id: 9,
                image: "images/chicken_mandi.jpg",
                name: "Ø¯Ø¬Ø§Ø¬ Ù…Ù†Ø¯ÙŠ",
                description: "Ø¯Ø¬Ø§Ø¬ Ù…Ù†Ø¯ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙØ­Ù… Ù…Ø¹ Ø±Ø²",
                price: 35,
                category: "Ø¯Ø¬Ø§Ø¬",
                spicy: 2
            },
            {
                id: 10,
                image: "images/chicken_mazbi.jpg",
                name: "Ø¯Ø¬Ø§Ø¬ Ù…Ø¸Ø¨ÙŠ",
                description: "Ø¯Ø¬Ø§Ø¬ Ù…Ø¸Ø¨ÙŠ Ù…Ø´ÙˆÙŠ Ù…Ø¹ Ø±Ø²",
                price: 38,
                category: "Ø¯Ø¬Ø§Ø¬",
                spicy: 3
            },
            {
                id: 11,
                image: "images/grilled_chicken.jpg",
                name: "Ø´ÙˆØ§ÙŠØ© Ø¯Ø¬Ø§Ø¬",
                description: "Ø¯Ø¬Ø§Ø¬ Ø´ÙˆØ§ÙŠØ© Ù…Ø¹ Ø±Ø² Ø£Ùˆ Ø¨Ø¯ÙˆÙ†",
                price: 30,
                category: "Ø¯Ø¬Ø§Ø¬",
                spicy: 1
            },
            {
                id: 12,
                image: "images/rice_bashawer.jpg",
                name: "Ø±Ø² Ø¨Ø´Ø§ÙˆØ±",
                description: "Ø±Ø² Ø¨Ø´Ø§ÙˆØ± Ø£Ø¨ÙŠØ¶",
                price: 12,
                category: "Ù…Ù‚Ø¨Ù„Ø§Øª",
                spicy: 0
            },
            {
                id: 13,
                image: "images/rice_nathri.jpg",
                name: "Ø±Ø² Ù†Ø«Ø±ÙŠ",
                description: "Ø±Ø² Ù†Ø«Ø±ÙŠ Ø´Ø¹Ø¨ÙŠ",
                price: 10,
                category: "Ù…Ù‚Ø¨Ù„Ø§Øª",
                spicy: 0
            },
            {
                id: 14,
                image: "images/jareesh.jpg",
                name: "Ø¬Ø±ÙŠØ´",
                description: "Ø¬Ø±ÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©",
                price: 12,
                category: "Ø£Ø·Ø¨Ø§Ù‚ Ø´Ø¹Ø¨ÙŠØ©",
                spicy: 1
            },
            {
                id: 15,
                image: "images/gersan.jpg",
                name: "Ù‚Ø±ØµØ§Ù†",
                description: "Ù‚Ø±ØµØ§Ù† Ø¨Ù„Ø­Ù… Ø£Ùˆ Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨",
                price: 12,
                category: "Ø£Ø·Ø¨Ø§Ù‚ Ø´Ø¹Ø¨ÙŠØ©",
                spicy: 1
            },
        ];

        // ========== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª ==========
        let cart = [];
        let chatStep = 0;
        let selectedPayment = '';
        let deliveryType = '';
        let userLocation = '';
        let loyaltyPoints = 0;
        let selectedRating = 0;
        let userPreferences = {
            spicyLevel: 'medium',
            allergies: [],
            favorites: []
        };
        let currentOrderId = null;
        let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
        let favoriteOrders = JSON.parse(localStorage.getItem('favoriteOrders')) || [];

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡ Ø§Ù„Ù…ØªØ·ÙˆØ± ==========
        const loyaltyTiers = {
            bronze: { minPoints: 0, discount: 5, name: "Ø¨Ø±ÙˆÙ†Ø²ÙŠ" },
            silver: { minPoints: 500, discount: 10, name: "ÙØ¶ÙŠ" },
            gold: { minPoints: 1000, discount: 15, name: "Ø°Ù‡Ø¨ÙŠ" }
        };

        // ========== Ø§Ù„Ø¹Ø±ÙˆØ¶  ==========
        const specialCombos = [
            {
                id: 1,
                name: "Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ±ÙˆØ«",
                name: "Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ±ÙˆØ«",
                items: [1, 6, 12],
                description: "Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©",
                originalPrice: 132,
                comboPrice: 110,
                savings: 22,
                serves: 4
            },
            {
                id: 2,
                name: "Ø¨Ø§Ù‚Ø© Ø§Ù„Ù„Ø­ÙˆÙ…",
                items: [2, 3, 4],
                description: "ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù…ÙŠØ²Ø© Ù…Ù† Ø§Ù„Ù„Ø­ÙˆÙ…",
                originalPrice: 190,
                comboPrice: 160,
                savings: 30,
                serves: 3
            }
        ];

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ ==========
        const deliveryZones = {
            'Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†': 30,
            'Ø­ÙŠ Ù‚Ø±Ø·Ø¨Ø©': 35,
            'Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³': 40,
            'Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§': 45,
            'Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©': 50
        };

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ==========
        const reservationSlots = [
            '18:00', '19:00', '20:00', '21:00', '22:00'
        ];

        // ========== Ø¨Ø§Ù‚Ø§Øª Ø§Ù„ØªØºØ°ÙŠØ© ==========
        const cateringPackages = [
            {
                id: 1,
                name: "Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©",
                serves: 10,
                price: 300,
                includes: ["Ù…Ù†Ø¯ÙŠ Ù„Ø­Ù…", "ÙƒØ¨Ø³Ø© Ø¯Ø¬Ø§Ø¬", "Ø±Ø² Ø¨Ø´Ø§ÙˆØ±", "Ø³Ù„Ø·Ø§Øª", "Ù…Ø´Ø±ÙˆØ¨Ø§Øª"]
            },
            {
                id: 2,
                name: "Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª",
                serves: 20,
                price: 550,
                includes: ["Ù…Ù†Ø¯ÙŠ Ù„Ø­Ù…", "Ù…Ø¸Ø¨ÙŠ Ù„Ø­Ù…", "ÙƒØ¨Ø³Ø©", "Ø±Ø² Ù†Ø«Ø±ÙŠ", "Ø³Ù„Ø·Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©", "Ù…Ø´Ø±ÙˆØ¨Ø§Øª"]
            }
        ];

        // ========== ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ==========
        const customerReviews = [
            { name: "Ø£Ø­Ù…Ø¯", rating: 5, comment: "Ø£Ø¬Ù…Ù„ Ø·Ø¹Ù… Ù…Ù†Ø¯ÙŠ Ø¬Ø±Ø¨ØªÙ‡ ÙÙŠ Ø­ÙŠØ§ØªÙŠ", date: "2024-01-15" },
            { name: "ÙØ§Ø·Ù…Ø©", rating: 4, comment: "Ø®Ø¯Ù…Ø© Ø³Ø±ÙŠØ¹Ø© ÙˆØ·Ø¹Ø§Ù… Ù„Ø°ÙŠØ°", date: "2024-01-10" },
            { name: "Ø®Ø§Ù„Ø¯", rating: 5, comment: "Ù†ÙƒÙ‡Ø© Ø£ØµÙŠÙ„Ø© ÙˆÙƒÙ…ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø©", date: "2024-01-08" }
        ];

        // ========== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==========
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, 'sent');
                input.value = '';
                processUserMessage(message);
            }
        }

        function addMessage(text, type) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const time = new Date().toLocaleTimeString('ar-EG', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            messageDiv.innerHTML = `
                <div>${text}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ========== Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ==========
        function showLoading(message) {
            const chatArea = document.getElementById('chatArea');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message received';
            loadingDiv.innerHTML = `
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
                <div>${message}</div>
            `;
            chatArea.appendChild(loadingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            return loadingDiv;
        }

        // ========== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
        function processUserMessage(message) {
            setTimeout(() => {
                const lowerMessage = message.toLowerCase();
                
                switch(chatStep) {
                    case 0:
                        if (message.includes('Ø§Ù„Ø³Ù„Ø§Ù…') || message.includes('Ø§Ù‡Ù„Ø§') || message.includes('Ù‡Ù„Ø§')) {
                            showWelcomeMessage();
                        }
                        break;
                    case 1:
                        if (lowerMessage.includes('Ù‚Ø§Ø¦Ù…Ø©') || lowerMessage.includes('menu') || lowerMessage.includes('Ø§Ù„Ù…Ù†ÙŠÙˆ')) {
                            showMenu();
                        } else if (lowerMessage.includes('Ø·Ù„Ø¨ÙŠ') || lowerMessage.includes('Ø§Ù„Ø·Ù„Ø¨')) {
                            showOrderSummary();
                        } else if (lowerMessage.includes('Ù†Ù‚Ø§Ø·') || lowerMessage.includes('ÙˆÙ„Ø§Ø¡')) {
                            showLoyaltyPoints();
                        } else if (lowerMessage.includes('ÙƒÙˆÙ…Ø¨Ùˆ') || lowerMessage.includes('Ø¹Ø±ÙˆØ¶')) {
                            showSpecialCombos();
                        } else if (lowerMessage.includes('Ø­Ø¬Ø²') || lowerMessage.includes('Ù…Ø§Ø¦Ø¯Ø©')) {
                            showReservationSystem();
                        } else if (lowerMessage.includes('ØªØºØ°ÙŠØ©') || lowerMessage.includes('Ù…Ù†Ø§Ø³Ø¨Ø©')) {
                            showCateringPackages();
                        } else if (lowerMessage.includes('ØªÙ‚ÙŠÙŠÙ…') || lowerMessage.includes('Ø§Ø±Ø§Ø¡')) {
                            showCustomerReviews();
                        } else if (lowerMessage.includes('Ù‡Ø¯ÙŠØ©') || lowerMessage.includes('ÙƒØ§Ø±Øª')) {
                            showGiftCards();
                        } else if (lowerMessage.includes('Ù…ÙØ¶Ù„') || lowerMessage.includes('Ø§Ø¹Ø§Ø¯Ø©')) {
                            showFavoriteOrders();
                        } else if (lowerMessage.includes('ØªØ®ØµÙŠØµ') || lowerMessage.includes('ØªÙØ¶ÙŠÙ„Ø§Øª')) {
                            showPreferencesMenu();
                        }
                        break;
                }
            }, 800);
        }

        // ========== Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ==========
        function showWelcomeMessage() {
            addMessage('ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡! ğŸŒ¹<br>Ø£Ù‡Ù„Ù‹Ø§ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ <b>Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ«</b>', 'received');
            
            setTimeout(() => {
                const offerHTML = `
                    <div class="offer-banner">
                        ğŸ¯ Ø§Ø·Ù„Ø¨ Ø¨Ø³Ø¹Ø± Ø§Ù„Ù…Ø­Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø¯ÙˆÙ† ÙˆØ³ÙŠØ·
                    </div>
                `;
                addMessage(offerHTML, 'received');
            }, 500);
            
            setTimeout(() => showMainMenu(), 1500);
        }

        // ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© ==========
        function showMainMenu() {
            addMessage('ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ', 'received');
            
            const quickReplies = document.getElementById('quickReplies');
            quickReplies.innerHTML = `
                <div class="quick-reply" onclick="showMenu()">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
                <div class="quick-reply" onclick="showSpecialCombos()">ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶ </div>
                <div class="quick-reply" onclick="showOrderSummary()">ğŸ›’ Ø¹Ø±Ø¶ Ø·Ù„Ø¨ÙŠ</div>
                <div class="quick-reply" onclick="showLoyaltyPoints()">ğŸ’ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</div>
                <div class="quick-reply" onclick="showReservationSystem()">ğŸ•’ Ø­Ø¬Ø² Ù…Ø§Ø¦Ø¯Ø©</div>
                <div class="quick-reply" onclick="showRestaurantInfo()">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…</div>
                <div class="quick-reply" onclick="showPreferencesMenu()">âš™ï¸ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª</div>
            `;
            
            chatStep = 1;
        }

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø·Ù„Ø¨ ==========
        function trackOrder(orderId) {
            const statusMessages = [
                "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±",
                "ğŸ‘¨â€ğŸ³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø·Ù‡ÙŠ", 
                "ğŸš— Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„",
                "âœ… ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"
            ];
            
            let currentStatus = 0;
            const trackingInterval = setInterval(() => {
                if (currentStatus < statusMessages.length) {
                    const statusHTML = `
                        <div class="order-status">
                            <div>${statusMessages[currentStatus]}</div>
                            <div style="font-size: 0.8em; margin-top: 5px;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${orderId}</div>
                        </div>
                    `;
                    addMessage(statusHTML, 'received');
                    currentStatus++;
                } else {
                    clearInterval(trackingInterval);
                }
            }, 5000);
        }

        // ========== Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙ…Ø¨ÙˆÙ‡Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ==========
        function showSpecialCombos() {
            let combosHTML = `
                <div class="menu-message">
                    <div class="menu-title">ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„ÙƒÙˆÙ…Ø¨ÙˆÙ‡Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</div>
                    <div style="text-align: center; margin-bottom: 12px; padding: 8px; background: #fff3e0; border-radius: 6px; font-size: 0.8em; color: #ff6f00;">
                        ğŸ’° ÙˆÙØ± Ø­ØªÙ‰ 30% Ù…Ø¹ Ø¹Ø±ÙˆØ¶Ù†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø©
                    </div>
            `;
            
            specialCombos.forEach(combo => {
                combosHTML += `
                    <div class="combo-offer" onclick="addComboToCart(${combo.id})">
                        <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 8px;">${combo.name}</div>
                        <div style="font-size: 0.9em; margin-bottom: 8px;">${combo.description}</div>
                        <div style="font-size: 0.8em; margin-bottom: 8px;">ÙŠÙƒÙÙŠ Ù„Ù€ ${combo.serves} Ø£Ø´Ø®Ø§Øµ</div>
                        <div class="combo-savings">ÙˆÙØ± ${combo.savings} Ø±.Ø³</div>
                        <div style="margin-top: 8px;">
                            <span style="text-decoration: line-through; color: #ccc; margin-left: 8px;">${combo.originalPrice} Ø±.Ø³</span>
                            <span style="font-weight: bold; color: white;">${combo.comboPrice} Ø±.Ø³</span>
                        </div>
                    </div>
                `;
            });
            
            combosHTML += `</div>`;
            
            addMessage(combosHTML, 'received');
        }

        // ========== Ø¥Ø¶Ø§ÙØ© ÙƒÙˆÙ…Ø¨Ùˆ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ==========
        function addComboToCart(comboId) {
            const combo = specialCombos.find(c => c.id === comboId);
            combo.items.forEach(itemId => {
                const item = menuItems.find(i => i.id === itemId);
                if (item) cart.push(item);
            });
            
            addMessage(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© <b>${combo.name}</b> Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©`, 'sent');
            
            setTimeout(() => {
                addMessage(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ø¥Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰<br>ğŸ’° ÙˆÙØ±Øª ${combo.savings} Ø±.Ø³`, 'received');
                showQuickRepliesAfterAdd();
            }, 400);
        }

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡ Ø§Ù„Ù…ØªØ·ÙˆØ± ==========
        function getCurrentTier() {
            if (loyaltyPoints >= loyaltyTiers.gold.minPoints) return loyaltyTiers.gold;
            if (loyaltyPoints >= loyaltyTiers.silver.minPoints) return loyaltyTiers.silver;
            return loyaltyTiers.bronze;
        }

        function showLoyaltyPoints() {
            const currentTier = getCurrentTier();
            const nextTier = currentTier.name === 'Ø°Ù‡Ø¨ÙŠ' ? null : 
                            currentTier.name === 'ÙØ¶ÙŠ' ? loyaltyTiers.gold : loyaltyTiers.silver;
            
            const loyaltyHTML = `
                <div class="loyalty-message">
                    <div style="font-size: 1.1em; margin-bottom: 8px;">ğŸ’ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²</div>
                    <div class="points-badge">${loyaltyPoints} Ù†Ù‚Ø·Ø©</div>
                    <div style="margin: 8px 0;">
                        <span class="tier-badge ${currentTier.name === 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ' ? 'bronze' : currentTier.name === 'ÙØ¶ÙŠ' ? 'silver' : 'gold'}">
                            ${currentTier.name}
                        </span>
                        Ø®ØµÙ… ${currentTier.discount}%
                    </div>
                    ${nextTier ? `
                        <div style="font-size: 0.8em; margin-top: 8px;">
                            ØªØ­ØªØ§Ø¬ ${nextTier.minPoints - loyaltyPoints} Ù†Ù‚Ø·Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙØ¦Ø© ${nextTier.name}
                        </div>
                    ` : ''}
                </div>
            `;
            addMessage(loyaltyHTML, 'received');
        }

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ==========
        function showReservationSystem() {
            const reservationHTML = `
                <div class="menu-message">
                    <div class="menu-title">ğŸ•’ Ø­Ø¬Ø² Ù…Ø§Ø¦Ø¯Ø©</div>
                    <div style="text-align: center; margin-bottom: 12px;">
                        <div style="font-size: 0.9em; margin-bottom: 8px;">Ø§Ø®ØªØ± Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø­Ø¬Ø²:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
                            ${reservationSlots.map(slot => `
                                <div class="reservation-slot" onclick="selectReservationSlot('${slot}')">
                                    ${slot}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            addMessage(reservationHTML, 'received');
        }

        function selectReservationSlot(slot) {
            addMessage(`ğŸ•’ Ø­Ø¬Ø² Ù…Ø§Ø¦Ø¯Ø© Ø§Ù„Ø³Ø§Ø¹Ø© ${slot}`, 'sent');
            
            setTimeout(() => {
                const confirmationHTML = `
                    <div class="success-message">
                        âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ<br>
                        <strong>Ø§Ù„Ø³Ø§Ø¹Ø© ${slot}</strong><br>
                        Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²: #R${Math.floor(Math.random() * 1000)}
                    </div>
                `;
                addMessage(confirmationHTML, 'received');
            }, 1000);
        }

        // ========== Ø¨Ø§Ù‚Ø§Øª Ø§Ù„ØªØºØ°ÙŠØ© ==========
        function showCateringPackages() {
            let cateringHTML = `
                <div class="menu-message">
                    <div class="menu-title">ğŸ½ï¸ Ø¨Ø§Ù‚Ø§Øª Ø§Ù„ØªØºØ°ÙŠØ© Ù„Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª</div>
                    <div style="text-align: center; margin-bottom: 12px; padding: 8px; background: #e3f2fd; border-radius: 6px; font-size: 0.8em; color: #1976d2;">
                        ğŸ‰ Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø²ÙˆØ§Ø¬Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©
                    </div>
            `;
            
            cateringPackages.forEach(pkg => {
                cateringHTML += `
                    <div class="catering-package" onclick="selectCateringPackage(${pkg.id})">
                        <div style="font-weight: bold; color: #075e54; margin-bottom: 8px;">${pkg.name}</div>
                        <div style="font-size: 0.85em; margin-bottom: 8px;">ÙŠÙƒÙÙŠ Ù„Ù€ ${pkg.serves} Ø£Ø´Ø®Ø§Øµ</div>
                        <div style="font-size: 0.8em; color: #666; margin-bottom: 8px;">
                            ${pkg.includes.join(' â€¢ ')}
                        </div>
                        <div style="font-weight: bold; color: #25d366; text-align: center;">${pkg.price} Ø±.Ø³</div>
                    </div>
                `;
            });
            
            cateringHTML += `</div>`;
            
            addMessage(cateringHTML, 'received');
        }

        function selectCateringPackage(packageId) {
            const pkg = cateringPackages.find(p => p.id === packageId);
            addMessage(`ğŸ½ï¸ ${pkg.name} - ${pkg.price} Ø±.Ø³`, 'sent');
            
            setTimeout(() => {
                addMessage(`âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø§Ù‚Ø© ${pkg.name}<br>ğŸ“ Ø³ÙŠØªØµÙ„ Ø¨ÙƒÙ… ÙØ±ÙŠÙ‚Ù†Ø§ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„`, 'received');
            }, 800);
        }

        // ========== ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
        function showPreferencesMenu() {
            const preferencesHTML = `
                <div class="menu-message">
                    <div class="menu-title">âš™ï¸ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø·Ù„Ø¨</div>
                    
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: bold; margin-bottom: 8px;">ğŸŒ¶ï¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª:</div>
                        <div class="preference-option ${userPreferences.spicyLevel === 'mild' ? 'selected' : ''}" onclick="setSpicyLevel('mild')">
                            Ø®ÙÙŠÙ
                        </div>
                        <div class="preference-option ${userPreferences.spicyLevel === 'medium' ? 'selected' : ''}" onclick="setSpicyLevel('medium')">
                            Ù…ØªÙˆØ³Ø·
                        </div>
                        <div class="preference-option ${userPreferences.spicyLevel === 'hot' ? 'selected' : ''}" onclick="setSpicyLevel('hot')">
                            Ø­Ø§Ø±
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: bold; margin-bottom: 8px;">ğŸš« Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©:</div>
                        <div style="font-size: 0.8em; color: #666; margin-bottom: 8px;">Ø§Ø®ØªØ± Ù…Ø§ ÙŠÙ†Ø·Ø¨Ù‚:</div>
                        <div class="preference-option ${userPreferences.allergies.includes('gluten') ? 'selected' : ''}" onclick="toggleAllergy('gluten')">
                            Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¬Ù„ÙˆØªÙŠÙ†
                        </div>
                        <div class="preference-option ${userPreferences.allergies.includes('dairy') ? 'selected' : ''}" onclick="toggleAllergy('dairy')">
                            Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ù„Ø¨Ø§Ù†
                        </div>
                        <div class="preference-option ${userPreferences.allergies.includes('nuts') ? 'selected' : ''}" onclick="toggleAllergy('nuts')">
                            Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…ÙƒØ³Ø±Ø§Øª
                        </div>
                    </div>
                </div>
            `;
            
            addMessage(preferencesHTML, 'received');
        }

        function setSpicyLevel(level) {
            userPreferences.spicyLevel = level;
            addMessage(`ğŸŒ¶ï¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª: ${level === 'mild' ? 'Ø®ÙÙŠÙ' : level === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ø­Ø§Ø±'}`, 'sent');
            
            setTimeout(() => {
                addMessage('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª', 'received');
            }, 500);
        }

        function toggleAllergy(allergy) {
            const index = userPreferences.allergies.indexOf(allergy);
            if (index > -1) {
                userPreferences.allergies.splice(index, 1);
            } else {
                userPreferences.allergies.push(allergy);
            }
            
            const allergyNames = {
                'gluten': 'Ø¬Ù„ÙˆØªÙŠÙ†',
                'dairy': 'Ø£Ù„Ø¨Ø§Ù†', 
                'nuts': 'Ù…ÙƒØ³Ø±Ø§Øª'
            };
            
            addMessage(`ğŸš« ${userPreferences.allergies.includes(allergy) ? 'ØªÙ… Ø¥Ø¶Ø§ÙØ©' : 'ØªÙ… Ø¥Ø²Ø§Ù„Ø©'} Ø­Ø³Ø§Ø³ÙŠØ© ${allergyNames[allergy]}`, 'sent');
        }

        // ========== ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ==========
        function showCustomerReviews() {
            let reviewsHTML = `
                <div class="menu-message">
                    <div class="menu-title">â­ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                    <div style="text-align: center; margin-bottom: 12px; padding: 8px; background: #f3e5f5; border-radius: 6px; font-size: 0.8em; color: #7b1fa2;">
                        ğŸ“¢ Ø´Ù‡Ø§Ø¯Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§ Ø§Ù„ÙƒØ±Ø§Ù…
                    </div>
            `;
            
            customerReviews.forEach(review => {
                reviewsHTML += `
                    <div class="review-card">
                        <div class="review-stars">
                            ${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}
                        </div>
                        <div style="font-weight: bold; margin-bottom: 5px;">${review.name}</div>
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">${review.comment}</div>
                        <div style="font-size: 0.7em; color: #999;">${review.date}</div>
                    </div>
                `;
            });
            
            reviewsHTML += `</div>`;
            
            addMessage(reviewsHTML, 'received');
        }

        // ========== ÙƒØ±ÙˆØª Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ==========
        function showGiftCards() {
            const giftCardHTML = `
                <div class="gift-card">
                    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">ğŸ ÙƒØ±Øª Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…ÙˆØ±ÙˆØ«</div>
                    <div style="margin-bottom: 10px;">Ø§Ù‡Ø¯Ù ØªØ¬Ø±Ø¨Ø© Ø·Ø¹Ø§Ù… Ù„Ø§ ØªÙÙ†Ø³Ù‰ Ù„Ø£Ø­Ø¨Ø§Ø¦Ùƒ</div>
                    <div style="display: flex; justify-content: space-around; margin: 15px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9em;">Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
                            <div style="font-weight: bold;">100 Ø±.Ø³</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9em;">Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
                            <div style="font-weight: bold;">200 Ø±.Ø³</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9em;">Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
                            <div style="font-weight: bold;">500 Ø±.Ø³</div>
                        </div>
                    </div>
                    <div style="font-size: 0.8em; opacity: 0.9;">ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© Ø³Ù†Ø© Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</div>
                </div>
            `;
            
            addMessage(giftCardHTML, 'received');
            
            setTimeout(() => {
                addMessage('Ù„Ø´Ø±Ø§Ø¡ ÙƒØ±Øª Ù‡Ø¯ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: 0550000000', 'received');
            }, 1000);
        }

        // ========== Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© ==========
        function showFavoriteOrders() {
            if (favoriteOrders.length === 0) {
                addMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙØ¶Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ â¤ï¸', 'received');
                return;
            }

            let favoritesHTML = `
                <div class="menu-message">
                    <div class="menu-title">â¤ï¸ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
            `;
            
            favoriteOrders.forEach((order, index) => {
                favoritesHTML += `
                    <div class="menu-item" onclick="reorderFavorite(${index})">
                        <div style="font-size: 1.2em; color: #ff6b6b;">â¤ï¸</div>
                        <div class="item-info">
                            <div class="item-name">Ø·Ù„Ø¨ ${index + 1}</div>
                            <div class="item-description">${order.items.length} ØµÙ†Ù â€¢ ${order.total} Ø±.Ø³</div>
                        </div>
                        <div class="item-price">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨</div>
                    </div>
                `;
            });
            
            favoritesHTML += `</div>`;
            
            addMessage(favoritesHTML, 'received');
        }

        function reorderFavorite(index) {
            const favorite = favoriteOrders[index];
            cart = [...favorite.items];
            
            addMessage(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ÙØ¶Ù„ #${index + 1}`, 'sent');
            
            setTimeout(() => {
                addMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ğŸ›’', 'received');
                showOrderSummary();
            }, 500);
        }

        // ========== Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ÙØ¶Ù„ ==========
        function saveCurrentOrderAsFavorite() {
            if (cart.length === 0) {
                showError('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
                return;
            }

            favoriteOrders.push({
                items: [...cart],
                timestamp: new Date(),
                total: calculateTotal()
            });
            
            localStorage.setItem('favoriteOrders', JSON.stringify(favoriteOrders));
            
            addMessage('â¤ï¸ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'sent');
            
            setTimeout(() => {
                addMessage('âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'received');
            }, 500);
        }

        // ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ ==========
        function validateOrder() {
            if (cart.length === 0) {
                showError('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø£ÙˆÙ„Ø§Ù‹');
                return false;
            }
            
            if (deliveryType === 'delivery' && !userLocation) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return false;
            }
            
            if (!selectedPayment) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹');
                return false;
            }
            
            return true;
        }

        function showError(message) {
            const errorHTML = `
                <div class="error-message">
                    âš ï¸ ${message}
                </div>
            `;
            addMessage(errorHTML, 'received');
        }

        // ========== Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ Ù„Ù„ØªÙˆØµÙŠÙ„ ==========
        function calculateDeliveryTime() {
            const baseTime = 30;
            const sizeMultiplier = cart.length > 3 ? 15 : 0;
            const locationTime = userLocation ? (deliveryZones[userLocation] || 40) : 40;
            
            return baseTime + sizeMultiplier + locationTime;
        }

        // ========== Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ==========
        // [ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ©: showMenu, addToCart, showOrderSummary, Ø¥Ù„Ø®.]
        // Ù„Ø£Ø³Ø¨Ø§Ø¨ ØªØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…Ø³Ø§Ø­Ø©ØŒ Ø³Ø£Ø¯Ø±Ø¬ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø£Ø¯Ù†Ø§Ù‡:

        function showMenu() {
            let menuHTML = `
                <div class="menu-message">
                    <div class="menu-title">ğŸ– Ù‚Ø§Ø¦Ù…Ø© Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ«</div>
                    <div style="text-align: center; margin-bottom: 8px; padding: 6px; background: #f8f9fa; border-radius: 6px; font-size: 0.8em; color: #25d366; font-weight: bold;">
                        ğŸ¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ù„ Ø¨Ø¯ÙˆÙ† ÙˆØ³ÙŠØ·
                    </div>
            `;
            
            menuItems.forEach(item => {
                menuHTML += `
                    <div class="menu-item" onclick="addToCart(${item.id})">
                        <img src="${item.image}" alt="${item.name}" class="item-image">
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-description">${item.description}</div>
                        </div>
                        <div class="item-price">${item.price} Ø±.Ø³</div>
                    </div>
                `;
            });
            
            menuHTML += `</div>`;
            
            addMessage(menuHTML, 'received');
            addMessage('Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Øª ğŸ‘†', 'received');
        }

        function addToCart(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            cart.push(item);
            
            addMessage(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© <b>${item.name}</b> Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©`, 'sent');
            
            setTimeout(() => {
                addMessage(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${item.name} Ø¥Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰<br>ğŸ’µ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù…Ø­Ù„: ${item.price} Ø±.Ø³`, 'received');
                showQuickRepliesAfterAdd();
            }, 400);
        }

        function showQuickRepliesAfterAdd() {
            const quickReplies = document.getElementById('quickReplies');
            quickReplies.innerHTML = `
                <div class="quick-reply" onclick="showMenu()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯</div>
                <div class="quick-reply" onclick="showOrderSummary()">ğŸ›’ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨</div>
                <div class="quick-reply" onclick="showLoyaltyPoints()">ğŸ’ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</div>
                <div class="quick-reply" onclick="saveCurrentOrderAsFavorite()">â¤ï¸ Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
                <div class="quick-reply" onclick="addMessage('ğŸ”„ ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©', 'sent'); cart = []; setTimeout(() => addMessage('ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ğŸ›’', 'received'), 500)">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</div>
            `;
        }

        function calculateTotal() {
            return cart.reduce((sum, item) => sum + item.price, 0);
        }

        function showOrderSummary() {
            if (cart.length === 0) {
                addMessage('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ ğŸ›’', 'received');
                return;
            }

            let total = calculateTotal();
            let orderHTML = `
                <div class="order-summary">
                    <div class="order-title">ğŸ›’ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                    <div style="text-align: center; margin-bottom: 8px; padding: 4px; background: #e8f5e8; border-radius: 4px; font-size: 0.75em; color: #25d366;">
                        ğŸ’° Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ù„
                    </div>
            `;
            
            cart.forEach(item => {
                orderHTML += `
                    <div class="order-item">
                        <span>${item.name}</span>
                        <span>${item.price} Ø±.Ø³</span>
                    </div>
                `;
            });
            
            orderHTML += `
                    <div class="order-total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} Ø±.Ø³</div>
                </div>
            `;
            
            addMessage(orderHTML, 'received');
            
            setTimeout(() => {
                addMessage('Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:', 'received');
                showDeliveryOptions();
            }, 500);
        }

        function showDeliveryOptions() {
            const quickReplies = document.getElementById('quickReplies');
            quickReplies.innerHTML = `
                <div class="quick-reply" onclick="selectDelivery('delivery')">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ (+15 Ø±.Ø³)</div>
                <div class="quick-reply" onclick="selectDelivery('pickup')">ğŸƒ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø­Ù„</div>
            `;
            
            chatStep = 2;
        }

        function selectDelivery(type) {
            deliveryType = type;
            const deliveryText = type === 'delivery' ? 'ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„' : 'ğŸƒ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø­Ù„';
            addMessage(deliveryText, 'sent');
            
            setTimeout(() => {
                if (type === 'delivery') {
                    askForLocation();
                } else {
                    proceedToPayment();
                }
            }, 800);
        }

        function askForLocation() {
            addMessage('ğŸ“ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆÙ‚Ø¹Ùƒ:', 'received');
            
            const locationHTML = `
                <div class="location-message">
                    <button class="location-btn" onclick="shareLocation()">
                        <i class="fas fa-map-marker-alt"></i>
                        Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹
                    </button>
                    <p style="font-size: 0.75em; color: #666; margin-top: 8px;">Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</p>
                </div>
            `;
            
            addMessage(locationHTML, 'received');
            chatStep = 3;
        }

        function shareLocation() {
            addMessage('ğŸ“ ØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'sent');
            
            const locations = [
                'Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†',
                'Ø­ÙŠ Ù‚Ø±Ø·Ø¨Ø©',
                'Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³',
                'Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§',
                'Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©'
            ];
            
            userLocation = locations[Math.floor(Math.random() * locations.length)];
            
            setTimeout(() => {
                addMessage(`âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ù…ÙˆÙ‚Ø¹Ùƒ:<br>${userLocation}`, 'received');
                setTimeout(() => {
                    proceedToPayment();
                }, 800);
            }, 1200);
        }

        function processLocation(message) {
            if (message.length > 5) {
                userLocation = message;
                addMessage(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:<br>${userLocation}`, 'received');
                setTimeout(() => {
                    proceedToPayment();
                }, 800);
            }
        }

        function proceedToPayment() {
            if (!validateOrder()) return;

            let total = calculateTotal();
            if (deliveryType === 'delivery') total += 15;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙˆÙ„Ø§Ø¡
            const currentTier = getCurrentTier();
            const discount = currentTier.discount;
            const discountAmount = (total * discount) / 100;
            const finalTotal = total - discountAmount;
            
            addMessage(`âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ!<br>${deliveryType === 'delivery' ? 'ğŸšš Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„' : 'ğŸƒ Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø­Ù„'}<br>${deliveryType === 'delivery' ? `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${userLocation}<br>` : ''}ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} Ø±.Ø³<br>ğŸ Ø®ØµÙ… Ø§Ù„ÙˆÙ„Ø§Ø¡: ${discount}% (${discountAmount} Ø±.Ø³)<br>ğŸ’ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalTotal} Ø±.Ø³`, 'received');
            
            setTimeout(() => {
                addMessage('ğŸ’³ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:', 'received');
                showPaymentOptions();
            }, 800);
        }

        function showPaymentOptions() {
            const paymentHTML = `
                <div class="payment-options">
                    <div class="payment-option" onclick="selectPayment('stc')">
                        <div class="payment-icon stcpay-color">STC</div>
                        <div class="payment-info">
                            <div class="payment-name">STC Pay</div>
                            <div class="payment-desc">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± STC Pay</div>
                        </div>
                    </div>
                    <div class="payment-option" onclick="selectPayment('mada')">
                        <div class="payment-icon mada-color">ğŸ’³</div>
                        <div class="payment-info">
                            <div class="payment-name">Ù…Ø¯Ù‰</div>
                            <div class="payment-desc">Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¯Ù‰</div>
                        </div>
                    </div>
                    <div class="payment-option" onclick="selectPayment('visa')">
                        <div class="payment-icon visa-color">ğŸ’³</div>
                        <div class="payment-info">
                            <div class="payment-name">ÙÙŠØ²Ø§ / Ù…Ø§Ø³ØªØ±ÙƒØ§Ø±Ø¯</div>
                            <div class="payment-desc">Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©</div>
                        </div>
                    </div>
                </div>
            `;
            
            addMessage(paymentHTML, 'received');
            
            const quickReplies = document.getElementById('quickReplies');
            quickReplies.innerHTML = `
                <div class="quick-reply" onclick="processPayment()">ğŸ’³ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</div>
                <div class="quick-reply" onclick="showDeliveryOptions()">â†©ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹</div>
            `;
        }

        function selectPayment(method) {
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            selectedPayment = method;
            
            let paymentName = '';
            switch(method) {
                case 'stc':
                    paymentName = 'STC Pay';
                    break;
                case 'mada':
                    paymentName = 'Ù…Ø¯Ù‰';
                    break;
                case 'visa':
                    paymentName = 'ÙÙŠØ²Ø§ / Ù…Ø§Ø³ØªØ±ÙƒØ§Ø±Ø¯';
                    break;
            }
            
            addMessage(`ğŸ’³ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ${paymentName}`, 'sent');
        }

        function processPayment() {
            if (!validateOrder()) return;

            let paymentName = '';
            switch(selectedPayment) {
                case 'stc':
                    paymentName = 'STC Pay';
                    break;
                case 'mada':
                    paymentName = 'Ù…Ø¯Ù‰';
                    break;
                case 'visa':
                    paymentName = 'ÙÙŠØ²Ø§ / Ù…Ø§Ø³ØªØ±ÙƒØ§Ø±Ø¯';
                    break;
            }
            
            const loading = showLoading(`ğŸ’³ Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ${paymentName}...`);
            
            setTimeout(() => {
                loading.remove();
                addMessage('âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!', 'received');
                
                setTimeout(() => {
                    let total = calculateTotal();
                    if (deliveryType === 'delivery') total += 15;
                    
                    const currentTier = getCurrentTier();
                    const discountAmount = (total * currentTier.discount) / 100;
                    const finalTotal = total - discountAmount;
                    
                    const deliveryTime = calculateDeliveryTime();
                    currentOrderId = 'LG' + Math.floor(Math.random() * 900 + 100);
                    
                    let deliveryInfo = deliveryType === 'delivery' 
                        ? `ğŸšš Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¥Ù„Ù‰:<br>${userLocation}<br>â° Ø®Ù„Ø§Ù„ ${deliveryTime} Ø¯Ù‚ÙŠÙ‚Ø©`
                        : 'ğŸƒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø®Ù„Ø§Ù„ 15-25 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ù„';
                    
                    addMessage(`ğŸ‰ Ø´ÙƒØ±Ù‹Ø§ Ù„Ø«Ù‚ØªÙƒ ÙÙŠ <b>Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ«</b><br>${deliveryInfo}<br>ğŸ’ Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù…Ø­Ù„ Ø¨Ø¯ÙˆÙ† ÙˆØ³ÙŠØ·<br>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${finalTotal} Ø±.Ø³<br>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${currentOrderId}`, 'received');
                    
                    // Ø­ÙØ¸ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    orderHistory.push({
                        id: currentOrderId,
                        items: [...cart],
                        total: finalTotal,
                        timestamp: new Date(),
                        status: 'completed'
                    });
                    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
                    
                    setTimeout(() => {
                        const earnedPoints = Math.floor(finalTotal / 10);
                        loyaltyPoints += earnedPoints;
                        
                        const loyaltyHTML = `
                            <div class="loyalty-message">
                                <div style="font-size: 1.1em; margin-bottom: 8px;">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· ÙˆÙ„Ø§Ø¡</div>
                                <div class="points-badge">+${earnedPoints} Ù†Ù‚Ø·Ø©</div>
                                <div style="font-size: 0.8em; margin-top: 8px;">
                                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø¢Ù†: <strong>${loyaltyPoints} Ù†Ù‚Ø·Ø©</strong><br>
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…!
                                </div>
                            </div>
                        `;
                        addMessage(loyaltyHTML, 'received');
                        
                        // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
                        setTimeout(() => {
                            trackOrder(currentOrderId);
                        }, 2000);
                        
                        setTimeout(() => {
                            showRatingSystem();
                        }, 15000);
                    }, 1000);
                }, 800);
            }, 2000);
        }

        // ========== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù… ==========
        function showRestaurantInfo() {
            const infoHTML = `
                <div class="menu-message">
                    <div class="menu-title">ğŸ– Ù…Ø·Ø¹Ù… Ø§Ù„Ù…ÙˆØ±ÙˆØ«</div>
                    <div style="text-align: center; line-height: 1.6; font-size: 0.85em;">
                        <strong>Ø£Ø¬ÙˆØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ£Ø·ÙŠØ¨ Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ø´Ø¹Ø¨ÙŠØ© ğŸ–</strong><br><br>
                        ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø´Ø§Ø±Ø¹ Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø§Ù„ÙˆÙ„ÙŠØ¯<br>
                        ğŸ•’ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 12:00 Ø¸Ù‡Ø±Ø§Ù‹ - 12:00 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„<br>
                        ğŸ“ Ù„Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 0550000000<br>
                        ğŸšš Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„: Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø±ÙŠØ§Ø¶
                    </div>
                </div>
            `;
            addMessage(infoHTML, 'received');
        }

        // ========== Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ==========
        window.onload = function() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const savedLoyalty = localStorage.getItem('loyaltyPoints');
            if (savedLoyalty) loyaltyPoints = parseInt(savedLoyalty);
            
            const savedPreferences = localStorage.getItem('userPreferences');
            if (savedPreferences) userPreferences = JSON.parse(savedPreferences);
            
            setTimeout(() => {
                addMessage('Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ğŸ‘‹', 'sent');
            }, 800);
            
            setTimeout(() => {
                showWelcomeMessage();
            }, 1600);
        };

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('loyaltyPoints', loyaltyPoints.toString());
            localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
        });

        document.addEventListener('touchstart', function() {}, {passive: true});
    </script>
</body>
</html>